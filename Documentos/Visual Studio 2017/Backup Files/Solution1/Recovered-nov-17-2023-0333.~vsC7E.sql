

SELECT 
PPESSOA.CEP AS CEP_FUNCIONARIO,
PSECAO.CGC AS CNPJ_SECAO,
upper(PSECAO.RUA) AS RUA_SECAO,
PSECAO.NUMERO AS NUMERO_SECAO,
upper(PSECAO.BAIRRO) AS BAIRRO_SECAO,
upper(PSECAO.CIDADE) AS CIDADE_SECAO,
PSECAO.CEP AS CEP_SECAO,
upper(PSECAO. ESTADO) AS ESTADO_SECAO,
GCOLIGADA.CODCOLIGADA,
GCOLIGADA.NOME AS NOME_COLIGADA,
GCOLIGADA.CGC,
GCOLIGADA.RUA,
GCOLIGADA.NUMERO,
GCOLIGADA.BAIRRO,
GCOLIGADA.CIDADE,
GCOLIGADA.CEP,
GCOLIGADA.ESTADO,
CONVERT(VARCHAR,GETDATE(),103) AS DATA_EMISSAO,
PFUNC.NOME AS NOME_FUNCIONARIO,
PFUNC.CHAPA,
PFUNC.NROFICHAREG,
(SELECT NOME FROM PFDEPEND AS F WHERE F.CHAPA = PFUNC.CHAPA AND F.CODCOLIGADA = PFUNC.CODCOLIGADA AND GRAUPARENTESCO = '6') AS PAI,
(SELECT NOME FROM PFDEPEND AS F WHERE F.CHAPA = PFUNC.CHAPA AND F.CODCOLIGADA = PFUNC.CODCOLIGADA AND GRAUPARENTESCO = '7') AS MAE,
PPESSOA.CARTEIRATRAB,
PPESSOA.SERIECARTTRAB,
PPESSOA.UFCARTTRAB,
CONVERT(VARCHAR,PPESSOA.DTCARTTRAB,103) AS CARTEIRA_TRABALHO,
PPESSOA.CERTIFRESERV,
PPESSOA.CATEGMILITAR,
PPESSOA.DTEMISSAOIDENT,
PPESSOA.REGPROFISSIONAL,
PPESSOA.TITULOELEITOR,
PPESSOA.ZONATITELEITOR,
PPESSOA.SECAOTITELEITOR,
PPESSOA.CPF,
PFUNC.PISPASEP,
PFUNC.DTCADASTROPIS,
PPESSOA.CARTMOTORISTA,
PPESSOA.TIPOCARTHABILIT,
PPESSOA.CARTIDENTIDADE,
PPESSOA.ORGEMISSORIDENT,
PPESSOA.UFCARTIDENT,
CONVERT(VARCHAR,PPESSOA.DTEMISSAOIDENT,103) AS EMISSAO_IDENTIDADE,
CONVERT(VARCHAR,PFUNC.DATAADMISSAO,103) AS DATAADMISSAO,
CONVERT(VARCHAR,PFUNC.DTOPCAOFGTS,103) AS OPCAOFGTS,
UPPER((SELECT DESCRICAO FROM PCODRECEB AS PCR WHERE PCR.CODCLIENTE = PFUNC.CODRECEBIMENTO)) AS FORMA_PAGAMENTO,
cast(PFUNC.JORNADAMENSAL/60 as varchar) +':00' AS JORNADA_MENSAL,
PFUNCAO.NOME,
PSECAO.DESCRICAO,
UPPER(PSECAO.CIDADE) + ',' + CONVERT(VARCHAR,PFUNC.DATAADMISSAO,103) AS ASSINATURA_DECLARACAO,
dbo.FormatoReal(PFUNC.SALARIO) AS SALARIO,
dbo.FormatoReal((PFUNC.SALARIO/(PFUNC.JORNADAMENSAL/60) )) as SALARIO_HORA,
CONVERT(VARCHAR,PPESSOA.DTNASCIMENTO,103) AS DATA_NASCIMENTO,
PPESSOA.ESTADOCIVIL,
UPPER((SELECT DESCRICAO FROM PCODESTCIVIL AS PCE WHERE PCE.CODCLIENTE = PPESSOA.ESTADOCIVIL)) AS EXTENSO_CIVIL,
PPESSOA.SEXO,
PPESSOA.GRAUINSTRUCAO,
UPPER((SELECT DESCRICAO FROM PCODINSTRUCAO AS PCI WHERE PCI.CODCLIENTE = PPESSOA.GRAUINSTRUCAO)) AS EXTENSO_INSTRUCAO,
PPESSOA.NACIONALIDADE,
UPPER((SELECT DESCRICAO FROM PCODNACAO AS PCI WHERE PCI.CODCLIENTE = PPESSOA.NACIONALIDADE)) AS EXTENSO_INSTRUCAO,
UPPER(PPESSOA.NATURALIDADE) AS NATURALIDADE,
PPESSOA.ESTADONATAL,
PPESSOA.RUA,
PPESSOA.NUMERO,
PPESSOA.BAIRRO,
PPESSOA.RUA + ', ' + PPESSOA.NUMERO + ' / ' + PPESSOA.BAIRRO + ' / ' + PPESSOA.CEP AS ENDERECO_DECLACAO,
UPPER(PPESSOA.CIDADE) + ' / ' + UPPER(PPESSOA.ESTADO) AS ENDERECO_DECLACAO,
UPPER(PPESSOA.CIDADE) AS CIDADE,
UPPER(AHORARIO.DESCRICAO) AS HORARIO,
GIMAGEM.IMAGEM,
GCOLIGADA.RUA + ', '+ GCOLIGADA.NUMERO + ' , ' + GCOLIGADA.CIDADE + ' / ' + GCOLIGADA.ESTADO as ENDERECO_COLIGADA,
PPESSOA.RUA  + ' , ' + PPESSOA.NUMERO +  (CASE WHEN PPESSOA.COMPLEMENTO IS NULL THEN ' ' ELSE ' , ' + PPESSOA.COMPLEMENTO END) AS ENDERECO_EMPREGADO_IRRF,
PSECAO.CIDADE,
PSECAO.ESTADO,
AHORARIO.CODIGO

FROM PFUNC 

LEFT JOIN GCOLIGADA (NOLOCK) ON (GCOLIGADA.CODCOLIGADA = PFUNC.CODCOLIGADA)
LEFT JOIN PPESSOA   (NOLOCK) ON (PPESSOA.CODIGO = PFUNC.CODPESSOA)
LEFT JOIN PFUNCAO   (NOLOCK) ON (PFUNCAO.CODIGO = PFUNC.CODFUNCAO AND PFUNCAO.CODCOLIGADA = PFUNC.CODCOLIGADA)
LEFT JOIN PSECAO    (NOLOCK) ON (PSECAO.CODIGO = PFUNC.CODSECAO AND PSECAO.CODCOLIGADA =PFUNC.CODCOLIGADA)
LEFT JOIN AHORARIO  (NOLOCK) ON (PFUNC.CODHORARIO = AHORARIO.CODIGO AND PFUNC.CODCOLIGADA = AHORARIO.CODCOLIGADA)
LEFT JOIN GIMAGEM   (NOLOCK) ON (GIMAGEM.ID = GCOLIGADA.IDIMAGEM)

WHERE PFUNC.CHAPA = '10609'--:chapa
AND PFUNC.CODCOLIGADA =7-- :coligada 
AND PFUNC.CODSITUACAO <>'D'
